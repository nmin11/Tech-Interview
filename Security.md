## JWT를 사용해야 하는 이유가 뭔가요?

JWT 토큰 기반 인증 방식은 필요한 모든 정보, 즉, 토큰에 대한 기본 정보, 전달할 정보, 그리고 토큰이 검증되었다는 것을 증명해줄 signature를 한번에 포함하고 있습니다.  
필요한 모든 정보를 토큰 자체에 포함하기 때문에 별도의 저장소가 필요 없습니다.  
또한, 쿠키를 전달할 필요도 없으므로 쿠키를 사용함으로써 발생하는 취약점이 사라집니다.

<br>

## JWT의 개념과 작동 방식에 대해서 설명해주세요

JSON Web Token은 RFC 7519 표준의 토큰 기반 인증 방식입니다.  
토큰 방식은 세션과 달리 인증 관련 정보가 서버가 아닌 클라이언트에 저장되기  
때문에 서버 부담을 줄일 수 있게 합니다.  
그리고 JWT의 핵심적인 특징은 토큰 자체에  
사용자의 권한 정보나 서비스를 사용하기 위한 정보가 포함되어 있다는 것입니다.  
JWT를 사용하면 stateless 환경에서 사용자 데이터를 주고 받을 수 있게 됩니다.

<br>

작동하는 순서를 살피자면 우선 사용자가 클라이언트를 통해 ID, 비밀번호를 인증받습니다.  
그러면 서버는 서명된 JWT를 생성하여 응답으로 돌려줍니다.  
클라이언트는 이걸 받아서, 유저가 서버에 요청할 때 JWT를 HTTP Header에 첨부합니다.  
그리고 그때마다 서버는 클라이언트로부터 온 JWT를 검증하게 되는 것입니다.

<br>

구조를 살펴보자면 JWT는 Header, Payload, Signature로 구성되어 있고,  
각 요소는 `.`으로 구분됩니다.  
우선 Header에는 사용할 타입과 해시 알고리즘 종류가 담겨 있고,  
Payload에는 서버에서 첨부한 사용자 권한 정보와 데이터가 담겨 있습니다.  
그리고 Signature에는 Header와 Payload를 Base 64 URL safe Encode 한 이후  
Header에 명시된 해시 함수를 적용하고 개인키로 서명한 전자서명이 담겨 있습니다.  
그리고 이를 모두 하나의 JWT로 표현하기 위해  
앞서 3가지 요소들을 모두 Base64 URL safe Encode로 처리하고 합치면 되는 것입니다.

<br>

마지막으로 장단점을 살펴보자면,  
JWT는 웹 서비스에서 범용적으로 사용되고 규격도 정해져 있기 때문에  
다양한 클라이언트에서 호환성이 뛰어납니다.  
하지만 서버의 부담을 줄이기 위해 클라이언트가 JWT를 가지고 있다곤 하지만  
Payload 부분이 길어지면 토큰이 커져서 서버에 부담이 가게 될 수도 있습니다.  
그리고 토큰 재발급 이전에 사용자 정보가 갱신되면 이것이 적용되지 않는 문제가 있습니다.  
그렇지만 stateless 환경에서 통신하기 용이하고 사용이 쉽기에 널리 사용되고 있습니다.

<br>

## Client에서 JWT를 어디에 저장하나요?

우선 안 좋은 방법으로는 JavaScript의 private variable에 저장하는 방법이 있습니다.  
이 방법을 사용하면 페이지를 새로고침할 때마다 토큰이 사라집니다.  
그러면 유저가 그때마다 다시 로그인해야되므로 UX 상으로 좋지 않습니다.

<br>

그 다음으로는 Local Storage에 저장하거나, Cookie에 저장하는, 2가지 방식이 남습니다.  
이 둘은 각각의 장단점이 있어서 무조건 어느 쪽을 써야한다는 통일된 의견이 없습니다.

<br>

Local Storage의 경우에는 토큰이 JS 코드에 의해 헤더에 담기게 되므로,  
해커가 정상적인 사용자인 척하며 request를 보내는 CSRF 공격에는 대비가 된다는 장점이 있습니다.  
반면에 악의적인 JS 코드를 브라우저에서 실행시키는 XSS 공격을 받으면  
해커가 Local Storage를 자유자재로 들어올 수 있게 되어버립니다.

<br>

Cookie의 경우에는 httpOnly 옵션을 사용할 수 있기 때문에 악의적인 JS 코드 실행이 불가능합니다.  
하지만 쿠키의 내용을 볼 수 없는 것이지, JS로 request를 보낼 수 없는 것은 아니어서  
자동으로 request에 실리게 되는 쿠키의 특성상, 사용자의 컴퓨터에서 위조할 수 있다는 위험이 있습니다.  
그리고 이러한 방식으로 XSS 공격에 뚫리게 되면 쿠키의 httpOnly도 안전하지 않게 됩니다.  
또한 쿠키는 http request에 자동으로 실리기 때문에 해커가 url만 알면  
request를 위조하기에도 쉽습니다.
